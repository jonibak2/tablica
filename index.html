<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>转 拽</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
    }
    table {
      border-collapse: collapse;
      width: 100%;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 10px;
      text-align: center;
      vertical-align: top;
      position: relative;
    }
    th {
      background-color: #70ac4c;
      color: white;
    }
    .today {
      background-color: #8bc34a !important;
    }
    .checkboxes label {
      display: inline-block;
      margin: 0 2px;
      position: relative;
    }
    .tooltip {
      display: none;
      position: absolute;
      bottom: 100%;
      right: 0;
      background: #fff;
      border: 1px solid #ccc;
      padding: 10px;
      z-index: 10;
      max-width: 300px;
      white-space: pre-line;
      text-align: right;
    }
    label:hover .tooltip {
      display: block;
    }
    #admin-button {
      position: fixed;
      bottom: 10px;
      left: 10px;
    }
    #admin-panel {
      display: none;
      position: fixed;
      bottom: 40px;
      left: 10px;
      background: white;
      border: 1px solid #ccc;
      padding: 10px;
    }
    .name-header {
      background-color: #f09c9c !important;
    }
    select, textarea {
      margin-top: 5px;
      width: 100%;
    }
  </style>
</head>
<body>
  <h1>转 砖转</h1>
  <table id="schedule-table">
    <thead>
      <tr>
        <th class="name-header">砖</th>
        <th id="day-0"></th>
        <th id="day-1"></th>
        <th id="day-2"></th>
        <th id="day-3"></th>
        <th id="day-4"></th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>专</td>
        <td class="cell"></td>
        <td class="cell"></td>
        <td class="cell"></td>
        <td class="cell"></td>
        <td class="cell"></td>
      </tr>
      <tr>
        <td>注拽</td>
        <td class="cell"></td>
        <td class="cell"></td>
        <td class="cell"></td>
        <td class="cell"></td>
        <td class="cell"></td>
      </tr>
      <tr>
        <td></td>
        <td class="cell"></td>
        <td class="cell"></td>
        <td class="cell"></td>
        <td class="cell"></td>
        <td class="cell"></td>
      </tr>
    </tbody>
  </table>

  <button id="admin-button"> 住转 </button>
  <div id="admin-panel">
    <label>拽 砖: <input type="password" id="admin-code"></label>
    <button onclick="checkAdminCode()">砖专</button><br>
    <select id="admin-row">
      <option value="0">专</option>
      <option value="1">注拽</option>
      <option value="2"></option>
    </select>
    <select id="admin-col">
      <option value="0">专砖</option>
      <option value="1">砖</option>
      <option value="2">砖砖</option>
      <option value="3">专注</option>
      <option value="4">砖</option>
    </select>
    <textarea id="bulk-tooltip" rows="12" placeholder="拽  转 拽住..."></textarea>
    <button onclick="applyBulkTooltip()"> 拽住</button>
    <button onclick="clearAll()">拽 </button>
  </div>

  <script>
    const isAdmin = { status: false };

    function createCheckboxCell(cell, rowIndex, colIndex) {
      const container = document.createElement('div');
      container.className = 'checkboxes';

      for (let i = 1; i <= 6; i++) {
        const label = document.createElement('label');
        label.innerText = i;

        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        const key = `checkbox-${rowIndex}-${colIndex}-${i}`;
        checkbox.checked = localStorage.getItem(key) === 'true';
        checkbox.addEventListener('change', () => {
          localStorage.setItem(key, checkbox.checked);
        });

        const tooltip = document.createElement('div');
        tooltip.className = 'tooltip';
        tooltip.innerText = localStorage.getItem(`tooltip-${rowIndex}-${colIndex}-${i}`) || ' 注';

        label.appendChild(checkbox);
        label.appendChild(tooltip);

        label.addEventListener('click', (e) => {
          e.stopPropagation();
          if (isAdmin.status) {
            e.preventDefault();
            const newText = prompt('注专 注 注专 转 :', tooltip.innerText);
            if (newText !== null) {
              tooltip.innerText = newText;
              localStorage.setItem(`tooltip-${rowIndex}-${colIndex}-${i}`, newText);
            }
          }
        });

        container.appendChild(label);
      }

      cell.appendChild(container);
    }

    document.querySelectorAll('.cell').forEach((cell, i) => {
      const rowIndex = Math.floor(i / 5);
      const colIndex = i % 5;
      createCheckboxCell(cell, rowIndex, colIndex);
    });

    const adminBtn = document.getElementById('admin-button');
    const adminPanel = document.getElementById('admin-panel');

    adminBtn.addEventListener('click', () => {
      adminPanel.style.display = 'block';
    });

    function checkAdminCode() {
      const code = document.getElementById('admin-code').value;
      if (code === '1111') {
        isAdmin.status = true;
        alert('住 爪注 爪!');
        adminPanel.style.display = 'block';
      } else {
        alert('拽 砖!');
      }
    }

    function applyBulkTooltip() {
      const text = document.getElementById('bulk-tooltip').value;
      const row = parseInt(document.getElementById('admin-row').value);
      const col = parseInt(document.getElementById('admin-col').value);
      const blocks = text.split(/\-+/).map(t => t.trim()).filter(t => t);

      blocks.forEach((block, i) => {
        const tooltipKey = `tooltip-${row}-${col}-${i + 1}`;
        localStorage.setItem(tooltipKey, block);

        const checkbox = document.querySelector(`.cell:nth-child(${col + 2})`).parentNode.children[row + 1].children[col + 1].querySelectorAll('label')[i];
        if (checkbox) {
          checkbox.querySelector('.tooltip').innerText = block;
        }
      });
    }

    function clearAll() {
      if (!confirm(' 转  砖专爪 拽转 ?')) return;
      for (let i = 0; i < 3; i++) {
        for (let j = 0; j < 5; j++) {
          for (let k = 1; k <= 6; k++) {
            localStorage.removeItem(`checkbox-${i}-${j}-${k}`);
            localStorage.removeItem(`tooltip-${i}-${j}-${k}`);
          }
        }
      }
      location.reload();
    }

    const days = ['专砖', '砖', '砖砖', '专注', '砖'];
    const today = new Date();
    const todayIndex = (today.getDay() + 6) % 7;
    for (let i = 0; i < 5; i++) {
      const date = new Date();
      date.setDate(today.getDate() - todayIndex + i);
      const str = `${days[i]}<br>${date.getDate()}.${date.getMonth() + 1}`;
      const th = document.getElementById(`day-${i}`);
      th.innerHTML = str;
      if (i === todayIndex) th.classList.add('today');
    }
  </script>
</body>
</html>
