<!DOCTYPE html>
<html lang="he" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>טבלת משימות UTECH</title>
    <link rel="icon" href="logo.jpg" type="image/jpeg" />
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
      import {
        getDatabase,
        ref,
        set,
        onValue,
        get,
        off,
      } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";

      const firebaseConfig = {
        apiKey: "AIzaSyAFTYDz4TvUfiXx1F3xFer86WV-UMVRi7U",
        authDomain: "tablichka-e2c39.firebaseapp.com",
        databaseURL: "https://tablichka-e2c39-default-rtdb.firebaseio.com",
        projectId: "tablichka-e2c39",
        storageBucket: "tablichka-e2c39.appspot.com",
        messagingSenderId: "218058227797",
        appId: "1:218058227797:web:0525b8e6057350918c54dc",
      };

      const app = initializeApp(firebaseConfig);
      const db = getDatabase(app);

      const isAdmin = { status: false };
      const names = ["טימור", "יעקב", "עופר", "טכנאי ביצוע"];
      const dayNames = ["ראשון", "שני", "שלישי", "רביעי", "חמישי"];
      const teamColors = ["cyan"];
      const taskNumbers = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10];
      let isMobile = window.matchMedia("(max-width: 600px)").matches;

      // Автоматически устанавливаем админа для ПК
      isAdmin.status = !isMobile;

      let weekOffset = 0;
      const MIN_WEEK_OFFSET = -100;
      const MAX_WEEK_OFFSET = 100;

      // Для хранения callback-ов подписок
      const checkboxListeners = {};

      function createCheckboxCell(cell, rowIndex, colIndex) {
        const container = document.createElement("div");
        container.className = "checkboxes";

        taskNumbers.forEach((taskNum, i) => {
          const label = document.createElement("label");
          label.className = "no-task";

          const textDiv = document.createElement("div");
          textDiv.className = "task-label-text";

          const checkbox = document.createElement("input");
          checkbox.type = "checkbox";
          checkbox.disabled = !isMobile;

          const { dateRange } = getWeekDateRange(weekOffset);
          const dbKey = `notes/${dateRange}/${rowIndex}/${colIndex}/${i + 1}`;

          // Снимаем старую подписку, если есть
          if (checkboxListeners[dbKey]) {
            off(ref(db, dbKey), checkboxListeners[dbKey]);
          }

          // Подписка на обновления задачи
          const onValueCallback = (snapshot) => {
            const data = snapshot.val();
            label.innerHTML = '';
            if (!data) {
              label.style.background = '#fff';
              label.style.color = '#000';
              return;
            }
            checkbox.checked = data.checked || false;
            const phoneText = data.phones ? data.phones.map((p, i) => `טלפון ${i + 1}: ${p.phone}, שם: ${p.name}`).join("<br>") : "";
            const tooltip = document.createElement("div");
            tooltip.className = "tooltip";
            tooltip.innerHTML = `כתובת: ${data.address || ""}<br>קוד כניסה: ${data.code || ""}<br>${phoneText}<br>משימה: ${data.reason || ""}<br>הערות: ${data.comments || ""}`;
            if (data.address && data.address.trim()) {
              textDiv.innerHTML = `<div>${data.address}</div><div style='font-size:0.9em;color:#888;'>${taskNum}</div>`;
            } else {
              textDiv.innerHTML = `<div>${taskNum}</div>`;
            }
            if (data.checked) {
              label.style.background = '#d4f7d4';
              label.style.color = '#008000';
            } else if (data.teamColor) {
              label.style.background = '#e0f7fa';
              label.style.color = '#00ced1';
            } else {
              label.style.background = '#fff';
              label.style.color = '#000';
            }
            label.appendChild(textDiv);
            label.appendChild(checkbox);
            label.appendChild(tooltip);
            label.onclick = (e) => {
              if (isAdmin.status && e.target !== checkbox) {
                fillAdminPanelWithTaskData(data, dbKey, rowIndex, colIndex, i + 1);
              }
            };
          };
          checkboxListeners[dbKey] = onValueCallback;
          onValue(ref(db, dbKey), onValueCallback);

          // Обработчик изменения чекбокса
          checkbox.addEventListener('change', async () => {
            const snapshot = await get(ref(db, dbKey));
            const data = snapshot.val() || {};
            await set(ref(db, dbKey), { ...data, checked: checkbox.checked });

            // Если это командная задача — обновить и вторую
            if (data.teamColor) {
              for (let otherColIndex = 0; otherColIndex < names.length; otherColIndex++) {
                if (otherColIndex !== colIndex) {
                  const otherKey = `notes/${dateRange}/${rowIndex}/${otherColIndex}/${i + 1}`;
                  const otherSnap = await get(ref(db, otherKey));
                  const otherData = otherSnap.val();
                  if (otherData && otherData.teamColor === data.teamColor) {
                    await set(ref(db, otherKey), { ...otherData, checked: checkbox.checked });
                  }
                }
              }
            }
          });

          container.appendChild(label);

          // --- Обработчики для открытия задачи на полный экран ---
          let longPressTimer = null;
          let longPressTarget = null;

          // Для ПК: долгое нажатие (мышь)
          label.addEventListener('mousedown', (e) => {
            if (e.target.type === 'checkbox') return;
            longPressTarget = label;
            longPressTimer = setTimeout(() => {
              if (label.querySelector('.tooltip')?.innerText) {
                showTaskFullScreen(label.querySelector('.tooltip').innerText, {
                  dateRange,
                  rowIndex,
                  colIndex,
                  taskNumber: i + 1,
                  isTeamWork: false,
                  teamColor: null
                });
              }
            }, 500);
          });
          label.addEventListener('mouseup', () => { clearTimeout(longPressTimer); });
          label.addEventListener('mouseleave', () => { clearTimeout(longPressTimer); });

          // Для телефона: долгое нажатие (touch)
          label.addEventListener('touchstart', (e) => {
            if (e.target.type === 'checkbox') return;
            longPressTarget = label;
            longPressTimer = setTimeout(() => {
              if (label.querySelector('.tooltip')?.innerText) {
                showTaskFullScreen(label.querySelector('.tooltip').innerText, {
                  dateRange,
                  rowIndex,
                  colIndex,
                  taskNumber: i + 1,
                  isTeamWork: false,
                  teamColor: null
                });
              }
            }, 500);
          });
          label.addEventListener('touchend', () => { clearTimeout(longPressTimer); });
          label.addEventListener('touchcancel', () => { clearTimeout(longPressTimer); });


        });
        cell.appendChild(container);
      }

      function setupPhoneEntries() {
        let phoneCount = 1;
        document.getElementById("add-phone").addEventListener("click", () => {
          phoneCount++;
          const phoneList = document.getElementById("phone-list");
          const phoneEntry = document.createElement("div");
          phoneEntry.className = "phone-entry";
          phoneEntry.innerHTML = `
          <input type="tel" class="phone-number" placeholder="📞 הזן מספר טלפון" required>
          <input type="text" class="phone-name" placeholder="🙍‍♂️ שם איש קשר" required>
          <button class="remove-phone">−</button>
        `;
          phoneList.appendChild(phoneEntry);

          phoneEntry
            .querySelector(".remove-phone")
            .addEventListener("click", () => {
              if (phoneCount > 1) {
                phoneEntry.remove();
                phoneCount--;
              }
            });
        });
      }

      function setupCodeInputs() {
        const checkbox = document.getElementById(`no-code-entry`);
        const codeInput = document.getElementById(`code-entry`);
        const optionsDiv = document.getElementById(`code-entry-options`);
        const select = document.getElementById(`code-entry-option`);

        checkbox.addEventListener("change", () => {
          codeInput.style.display = checkbox.checked ? "none" : "block";
          optionsDiv.style.display = checkbox.checked ? "block" : "none";
          select.value = "";
        });
      }

      function resetAdminPanelCheckboxes() {
        const checkboxes = [
          "team-work",
          "no-code-entry",
        ];
        checkboxes.forEach((id) => {
          const checkbox = document.getElementById(id);
          if (checkbox) {
            checkbox.checked = false;
          }
        });

        document.getElementById("target-name-2-container").style.display =
          "none";

        const codeInput = document.getElementById(`code-entry`);
        const optionsDiv = document.getElementById(`code-entry-options`);
        const select = document.getElementById(`code-entry-option`);
        if (codeInput && optionsDiv && select) {
          codeInput.style.display = "block";
          optionsDiv.style.display = "none";
          select.value = "";
        }
      }

      function updateTableDisplay() {
        const selectedDay = parseInt(document.getElementById("day-select").value);
        const isMobile = window.matchMedia("(max-width: 600px)").matches;
        const rows = document.querySelectorAll('#schedule-table tbody tr');
        rows.forEach((row, rowIndex) => {
          if (isMobile) {
            row.style.display = (rowIndex === selectedDay) ? '' : 'none';
          } else {
            row.style.display = '';
          }
        });
      }

      function getWeekDateRange(offset = 0) {
        const now = new Date();
        // Найти ближайшее воскресенье (начало недели)
        const sunday = new Date(now);
        sunday.setHours(0,0,0,0);
        sunday.setDate(now.getDate() - now.getDay() + offset * 7);
        const thursday = new Date(sunday);
        thursday.setDate(sunday.getDate() + 4);

        const formatDate = (date) => {
          const dd = String(date.getDate()).padStart(2, "0");
          const mm = String(date.getMonth() + 1).padStart(2, "0");
          return `${dd}-${mm}`;
        };

        const weekNumber = Math.ceil(
          (sunday - new Date(sunday.getFullYear(), 0, 1)) /
            (7 * 24 * 60 * 60 * 1000)
        );
        const dateRange = `${formatDate(sunday)}_${formatDate(thursday)}`;
        return { weekNumber, dateRange, sunday, thursday };
      }

      function updateWeekDisplay() {
        const { sunday, thursday } = getWeekDateRange(weekOffset);
        const weekRange = `${sunday.getDate().toString().padStart(2, '0')}.${(sunday.getMonth()+1).toString().padStart(2, '0')}.${sunday.getFullYear()} ${thursday.getDate().toString().padStart(2, '0')}.${(thursday.getMonth()+1).toString().padStart(2, '0')}.${thursday.getFullYear()}`;
        document.getElementById('week-range').innerText = weekRange;
      }

      function updateTableDates() {
        const { sunday } = getWeekDateRange(weekOffset);
        const rows = document.querySelectorAll('#schedule-table tbody tr');
        const today = new Date();
        
        for (let i = 0; i < 5; i++) {
          const date = new Date(sunday);
          date.setDate(sunday.getDate() + i);
          const dd = String(date.getDate()).padStart(2, "0");
          const mm = String(date.getMonth() + 1).padStart(2, "0");
          const dayCell = rows[i].querySelector('td');
          if (dayCell) {
            dayCell.innerText = `${dayNames[i]} ${dd}.${mm}`;
            
            // Проверяем, является ли этот день сегодняшним
            const isToday = date.getDate() === today.getDate() && 
                           date.getMonth() === today.getMonth() && 
                           date.getFullYear() === today.getFullYear();
            
            if (isToday) {
              dayCell.classList.add('today');
            } else {
              dayCell.classList.remove('today');
            }
          }
        }
      }

      async function reloadTasksForWeek() {
        // Очищаем все ячейки
        document.querySelectorAll('.cell').forEach(cell => cell.innerHTML = '');
        // Загружаем задачи из базы для этой недели
        document.querySelectorAll(".cell").forEach((cell, i) => {
          const rowIndex = Math.floor(i / 4);
          const colIndex = i % 4;
          createCheckboxCell(cell, rowIndex, colIndex);
        });
        
        // Обновляем заметки для дней
        updateDayNotes();
      }

      function createDayNotesCells() {
        const rows = document.querySelectorAll('#schedule-table tbody tr');
        for (let dayIndex = 0; dayIndex < 5; dayIndex++) {
          const notesCell = rows[dayIndex].querySelector('.day-notes-cell');
          if (!notesCell) continue;
          notesCell.innerHTML = '';
          const notesContainer = document.createElement('div');
          notesContainer.className = 'day-notes-container';
          const notesTextarea = document.createElement('textarea');
          notesTextarea.className = 'day-notes-textarea';
          notesTextarea.placeholder = '📝 הערות ליום...';
          notesTextarea.rows = 3;
          notesTextarea.setAttribute('data-day', dayIndex);
          const saveButton = document.createElement('button');
          saveButton.className = 'day-notes-save-btn';
          saveButton.innerHTML = '💾';
          saveButton.title = 'שמור הערות';
          // Сохраняем заметки для каждого дня недели
          const { dateRange } = getWeekDateRange(weekOffset);
          const notesKey = `notes/${dateRange}/dayNotes/${dayIndex}`;
          // Загружаем существующие заметки
          onValue(ref(db, notesKey), (snapshot) => {
            const notes = snapshot.val();
            notesTextarea.value = notes || '';
          });
          // Сохраняем заметки при нажатии кнопки
          saveButton.addEventListener('click', async () => {
            try {
              await set(ref(db, notesKey), notesTextarea.value);
              saveButton.innerHTML = '✅';
              setTimeout(() => { saveButton.innerHTML = '💾'; }, 1000);
            } catch (error) {
              console.error('Error saving day notes:', error);
              alert('שגיאה בשמירת ההערות');
            }
          });
          notesContainer.appendChild(notesTextarea);
          notesContainer.appendChild(saveButton);
          notesCell.appendChild(notesContainer);
        }
      }

      async function updateDayNotes() {
        const { dateRange, weekNumber } = getWeekDateRange(weekOffset);
        
        for (let dayIndex = 0; dayIndex < 5; dayIndex++) {
          const notesKey = `notes/${dateRange}/dayNotes/${dayIndex}`;
          const snapshot = await get(ref(db, notesKey));
          const notes = snapshot.val();
          
          const textarea = document.querySelector(`.day-notes-textarea[data-day="${dayIndex}"]`);
          if (textarea) {
            textarea.value = notes || '';
          }
        }
      }

      function updateDayNotesDisplay() {
        const isMobile = window.matchMedia("(max-width: 600px)").matches;
        const selectedDay = parseInt(document.getElementById("day-select").value);
        
        // Удаляем существующую мобильную строку заметок
        const existingMobileRow = document.querySelector('.mobile-notes-row');
        if (existingMobileRow) {
          existingMobileRow.remove();
        }
        
        if (isMobile) {
          // Создаем отдельную строку для мобильных заметок
          const tbody = document.querySelector('#schedule-table tbody');
          const mobileNotesRow = document.createElement('tr');
          mobileNotesRow.className = 'mobile-notes-row';
          
          // Создаем ячейку, которая объединяет две колонки
          const mobileNotesCell = document.createElement('td');
          mobileNotesCell.colSpan = 6;
          mobileNotesCell.className = 'mobile-notes-cell';
          
          const notesContainer = document.createElement('div');
          notesContainer.className = 'mobile-notes-container';
          
          const notesTextarea = document.createElement('textarea');
          notesTextarea.className = 'mobile-notes-textarea';
          notesTextarea.placeholder = `📝 הערות ליום ${dayNames[selectedDay]}...`;
          notesTextarea.rows = 3;
          notesTextarea.setAttribute('data-day', selectedDay);
          
          const saveButton = document.createElement('button');
          saveButton.className = 'mobile-notes-save-btn';
          saveButton.innerHTML = '💾';
          saveButton.title = 'שמור הערות';
          
          // Сохраняем заметки для выбранного дня
          const { dateRange, weekNumber } = getWeekDateRange(weekOffset);
          const notesKey = `notes/${dateRange}/dayNotes/${selectedDay}`;
          
          // Загружаем существующие заметки
          onValue(ref(db, notesKey), (snapshot) => {
            const notes = snapshot.val();
            if (notes) {
              notesTextarea.value = notes;
            } else {
              notesTextarea.value = '';
            }
          });
          
          // Сохраняем заметки при нажатии кнопки
          saveButton.addEventListener('click', async () => {
            try {
              await set(ref(db, notesKey), notesTextarea.value);
              // Показываем краткое уведомление об успехе
              saveButton.innerHTML = '✅';
              setTimeout(() => {
                saveButton.innerHTML = '💾';
              }, 1000);
            } catch (error) {
              console.error('Error saving day notes:', error);
              alert('שגיאה בשמירת ההערות');
            }
          });
          
          notesContainer.appendChild(notesTextarea);
          notesContainer.appendChild(saveButton);
          mobileNotesCell.appendChild(notesContainer);
          mobileNotesRow.appendChild(mobileNotesCell);
          tbody.appendChild(mobileNotesRow);
          
          // Скрываем обычные заметки на мобильных
          document.querySelectorAll('.day-notes-cell').forEach(cell => {
            cell.style.display = "none";
          });
          const headerCell = document.querySelector('.day-notes-header');
          if (headerCell) {
            headerCell.style.display = "none";
          }
        } else {
          // На десктопе показываем обычные заметки
          document.querySelectorAll('.day-notes-cell').forEach(cell => {
            cell.style.display = "";
          });
          const headerCell = document.querySelector('.day-notes-header');
          if (headerCell) {
            headerCell.style.display = "";
          }
        }
      }

      document.addEventListener("DOMContentLoaded", () => {
        document.querySelectorAll(".cell").forEach((cell, i) => {
          const rowIndex = Math.floor(i / 4);
          const colIndex = i % 4;
          createCheckboxCell(cell, rowIndex, colIndex);
        });

        resetAdminPanelCheckboxes();

        // Показываем/скрываем панель редактирования в зависимости от типа устройства
        document.getElementById("single-panel").style.display = !isMobile ? "block" : "none";

        document.getElementById("team-work").addEventListener("change", () => {
          document.getElementById("target-name-2-container").style.display =
            document.getElementById("team-work").checked ? "block" : "none";
        });

        setupPhoneEntries();
        setupCodeInputs();

        document
          .getElementById("single-insert")
          .addEventListener("click", async () => {
            // 1. Собираем все значения формы
            const isTeamWork = document.getElementById("team-work").checked;
            const targetName1 = document.getElementById("target-name").value;
            const targetName2 = isTeamWork ? document.getElementById("target-name-2").value : null;
            const targetDay = document.getElementById("target-day").value;
            const targetNumber = document.getElementById("target-number").value;
            const address = document.getElementById("task-address").value.trim();
            const reason = document.getElementById("task-reason").value.trim();
            const comments = document.getElementById("task-comments").value.trim();
            const phoneEntries = document.querySelectorAll(".phone-entry");
            const phones = [];
            for (let i = 0; i < phoneEntries.length; i++) {
              const phone = phoneEntries[i].querySelector(".phone-number").value.trim();
              const name = phoneEntries[i].querySelector(".phone-name").value.trim();
              if (!phone || !name) return alert("נא למלא את כל שדות הטלפון והשמות");
              phones.push({ phone, name });
            }
            const codes = {
              entry: {
                noCode: document.getElementById("no-code-entry").checked,
                code: document.getElementById("code-entry").value.trim(),
                option: document.getElementById("code-entry-option").value,
              },
            };
            if (!targetName1 || !targetDay || !targetNumber || !address || !reason) {
              return alert("נא למלא את כל השדות");
            }
            if (isTeamWork && (!targetName2 || targetName1 === targetName2)) {
              return alert("נא לבחור שני אנשים שונים לעבודת צוות");
            }
            if (!codes.entry.noCode && !codes.entry.code) {
              return alert("נא להזין קוד עבור כניסה או לסמן אין קוד");
            }
            if (codes.entry.noCode && !codes.entry.option) {
              return alert("נא לבחור סיבה עבור אין קוד בכניסה");
            }
            // --- ВСТАВКА МЕЖДУ ЗАДАЧАМИ ---
            let insertNumber = parseInt(targetNumber);
            const insertBetween = document.getElementById('insert-between-checkbox').checked;
            if (insertBetween) {
              const between1 = parseInt(document.getElementById('between-task1').value);
              const between2 = parseInt(document.getElementById('between-task2').value);
              insertNumber = between2;
              if (between2 > 10) {
                return alert('Нельзя вставить выше 10-й задачи!');
              }
              const { dateRange } = getWeekDateRange(weekOffset);
              for (let n = 10; n >= between2 + 1; n--) {
                const oldKey = `notes/${dateRange}/${targetDay}/${names.indexOf(targetName1)}/${n-1}`;
                const newKey = `notes/${dateRange}/${targetDay}/${names.indexOf(targetName1)}/${n}`;
                // eslint-disable-next-line no-await-in-loop
                const snap = await get(ref(db, oldKey));
                if (snap.exists()) {
                  const data = snap.val();
                  data.taskNumber = n;
                  // eslint-disable-next-line no-await-in-loop
                  await set(ref(db, newKey), data);
                  // eslint-disable-next-line no-await-in-loop
                  await set(ref(db, oldKey), null);
                }
              }
              if (isTeamWork) {
                const colIndex2 = names.indexOf(targetName2);
                if (colIndex2 !== -1) {
                  for (let n = 10; n >= between2 + 1; n--) {
                    const oldKey2 = `notes/${dateRange}/${targetDay}/${colIndex2}/${n-1}`;
                    const newKey2 = `notes/${dateRange}/${targetDay}/${colIndex2}/${n}`;
                    // eslint-disable-next-line no-await-in-loop
                    const snap2 = await get(ref(db, oldKey2));
                    if (snap2.exists()) {
                      const data2 = snap2.val();
                      data2.taskNumber = n;
                      // eslint-disable-next-line no-await-in-loop
                      await set(ref(db, newKey2), data2);
                      // eslint-disable-next-line no-await-in-loop
                      await set(ref(db, oldKey2), null);
                    }
                  }
                }
              }
            }
            // --- КОНЕЦ ВСТАВКИ МЕЖДУ ---
            const teamColor = isTeamWork ? "cyan" : null;
            const { dateRange } = getWeekDateRange(weekOffset);
            const rowIndex = parseInt(targetDay);
            const colIndex = names.indexOf(targetName1);
            // 2. Сохраняем задачу во временную ячейку в базе
            const tempTask = {
              checked: false,
              name: targetName1,
              day: dayNames[rowIndex],
              taskNumber: insertNumber,
              address: address,
              code: codes.entry.noCode ? codes.entry.option : codes.entry.code,
              phones: phones,
              reason: reason,
              comments: comments,
              teamColor: teamColor,
            };
            await set(ref(db, "notes/tempTask"), tempTask);
            // 3. После успешной записи — читаем из tempTask и сохраняем в нужное место
            const tempSnap = await get(ref(db, "notes/tempTask"));
            if (tempSnap.exists()) {
              const dataToSave = tempSnap.val();
              const dbKey = `notes/${dateRange}/${rowIndex}/${colIndex}/${insertNumber}`;
              await set(ref(db, dbKey), dataToSave);
              if (isTeamWork) {
                const colIndex2 = names.indexOf(targetName2);
                if (colIndex2 !== -1) {
                  const dbKey2 = `notes/${dateRange}/${rowIndex}/${colIndex2}/${insertNumber}`;
                  await set(ref(db, dbKey2), {
                    ...dataToSave,
                    name: targetName2,
                  });
                }
              }
              // Очищаем tempTask
              await set(ref(db, "notes/tempTask"), null);
              showNotification('משימה נשמרה בהצלחה');
              reloadTasksForWeek();
            }
          });

        document.getElementById("team-work").addEventListener("change", () => {
          document.getElementById("target-name-2-container").style.display =
            document.getElementById("team-work").checked ? "block" : "none";
        });

        document.getElementById('next-week').addEventListener('click', () => {
          if (weekOffset < MAX_WEEK_OFFSET) {
            weekOffset++;
            updateWeekDisplay();
            updateTableDates();
            reloadTasksForWeek();
            createDayNotesCells();
            updateDayNotesDisplay();
          }
        });
        document.getElementById('prev-week').addEventListener('click', () => {
          if (weekOffset > MIN_WEEK_OFFSET) {
            weekOffset--;
            updateWeekDisplay();
            updateTableDates();
            reloadTasksForWeek();
            createDayNotesCells();
            updateDayNotesDisplay();
          }
        });

        const daySelect = document.getElementById("day-select");
        if (weekOffset === 0 && new Date().getDay() >= 0 && new Date().getDay() <= 4) {
          daySelect.value = new Date().getDay();
        } else {
          daySelect.value = 0;
        }

        daySelect.addEventListener("change", updateTableDisplay);
        daySelect.addEventListener("change", updateDayNotesDisplay);
        window.addEventListener("resize", () => {
          isMobile = window.matchMedia("(max-width: 600px)").matches;
          isAdmin.status = !isMobile;
          document.getElementById("single-panel").style.display = !isMobile ? "block" : "none";
          updateTableDisplay();
          updateDayNotesDisplay();
        });
        updateTableDisplay();
        updateDayNotesDisplay();

        document
          .getElementById("task-overlay")
          .addEventListener("click", (e) => {
            if (
              e.target === document.getElementById("task-overlay") ||
              e.target === document.getElementById("task-overlay-content")
            ) {
              document.getElementById("task-overlay").style.display = "none";
            }
          });

        if (window.matchMedia("(max-width: 600px)").matches) {
          history.pushState({ page: "main" }, null, location.href);
          window.addEventListener("popstate", (event) => {
            if (event.state?.page === "main") {
              document.getElementById("back-confirm-overlay").style.display =
                "flex";
              history.pushState({ page: "confirm" }, null, location.href);
            } else if (event.state?.page === "confirm") {
              document.getElementById("back-confirm-overlay").style.display =
                "none";
              window.history.go(-2);
            }
          });

          document
            .getElementById("back-cancel")
            .addEventListener("click", () => {
              document.getElementById("back-confirm-overlay").style.display =
                "none";
              history.pushState({ page: "main" }, null, location.href);
            });
        }

        updateWeekDisplay();  
        updateTableDates();
        reloadTasksForWeek();
        createDayNotesCells();
        updateDayNotesDisplay();

        // Add clear all fields button handler
        document.getElementById('clear-all-fields').addEventListener('click', clearAllFields);

        document.getElementById('insert-between-checkbox').addEventListener('change', function() {
          const betweenFields = document.getElementById('insert-between-fields');
          if (this.checked) {
            betweenFields.style.display = 'flex';
            document.getElementById('target-number').disabled = true;
          } else {
            betweenFields.style.display = 'none';
            document.getElementById('target-number').disabled = false;
          }
        });
        document.getElementById('between-task1').addEventListener('change', function() {
          const val = parseInt(this.value);
          const task2 = document.getElementById('between-task2');
          for (let i = 0; i < task2.options.length; i++) {
            task2.options[i].disabled = parseInt(task2.options[i].value) <= val;
          }
          if (parseInt(task2.value) <= val) {
            task2.value = (val + 1).toString();
          }
        });
      });

      function fillAdminPanelWithTaskData(taskData, dbKey, rowIndex, colIndex, taskNumber) {
        // Заполняем поля в админ панели данными задачи
        document.getElementById('target-name').value = taskData.name || '';
        document.getElementById('target-day').value = dayNames.indexOf(taskData.day);
        document.getElementById('target-number').value = taskData.taskNumber || '';
        document.getElementById('task-address').value = taskData.address || '';
        document.getElementById('task-reason').value = taskData.reason || '';
        document.getElementById('task-comments').value = taskData.comments || '';
        
        // Обрабатываем код входа
        const codeEntry = document.getElementById('code-entry');
        const noCodeEntry = document.getElementById('no-code-entry');
        const codeEntryOptions = document.getElementById('code-entry-options');
        const codeEntryOption = document.getElementById('code-entry-option');
        
        if (taskData.code === 'יש שומר' || taskData.code === 'אין קודן / דלת פתוחה') {
          noCodeEntry.checked = true;
          codeEntry.style.display = 'none';
          codeEntryOptions.style.display = 'block';
          codeEntryOption.value = taskData.code;
        } else {
          noCodeEntry.checked = false;
          codeEntry.style.display = 'block';
          codeEntryOptions.style.display = 'none';
          codeEntry.value = taskData.code || '';
        }
        
        // Обрабатываем телефоны
        const phoneList = document.getElementById('phone-list');
        phoneList.innerHTML = '';
        
        if (taskData.phones && taskData.phones.length > 0) {
          taskData.phones.forEach((phone, index) => {
            const phoneEntry = document.createElement('div');
            phoneEntry.className = 'phone-entry';
            phoneEntry.innerHTML = `
              <input type="tel" class="phone-number" placeholder="📞 הזן מספר טלפון" value="${phone.phone || ''}" required>
              <input type="text" class="phone-name" placeholder="🙍‍♂️ שם איש קשר" value="${phone.name || ''}" required>
              <button class="remove-phone">−</button>
            `;
            phoneList.appendChild(phoneEntry);
            
            phoneEntry.querySelector('.remove-phone').addEventListener('click', () => {
              if (phoneList.children.length > 1) {
                phoneEntry.remove();
              }
            });
          });
        } else {
          // Добавляем хотя бы одно поле телефона
          const phoneEntry = document.createElement('div');
          phoneEntry.className = 'phone-entry';
          phoneEntry.innerHTML = `
            <input type="tel" class="phone-number" placeholder="📞 הזן מספר טלפון" required>
            <input type="text" class="phone-name" placeholder="🙍‍♂️ שם איש קשר" required>
            <button class="remove-phone">−</button>
          `;
          phoneList.appendChild(phoneEntry);
          
          phoneEntry.querySelector('.remove-phone').addEventListener('click', () => {
            if (phoneList.children.length > 1) {
              phoneEntry.remove();
            }
          });
        }
        
        // Обрабатываем работу в команде
        const teamWork = document.getElementById('team-work');
        const targetName2Container = document.getElementById('target-name-2-container');
        const targetName2 = document.getElementById('target-name-2');
        
        if (taskData.teamColor) {
          teamWork.checked = true;
          targetName2Container.style.display = 'block';
          // Найдем второго участника команды
          const { dateRange, weekNumber } = getWeekDateRange(weekOffset);
          for (let otherRowIndex = 0; otherRowIndex < names.length; otherRowIndex++) {
            if (otherRowIndex !== rowIndex) {
              const otherKey = `notes/${dateRange}/${otherRowIndex}/${colIndex}/${taskNumber}`;
              get(ref(db, otherKey)).then(snapshot => {
                const otherData = snapshot.val();
                if (otherData && otherData.teamColor === taskData.teamColor) {
                  targetName2.value = otherData.name || '';
                }
              });
            }
          }
        } else {
          teamWork.checked = false;
          targetName2Container.style.display = 'none';
        }
        
        // Сохраняем данные для использования при сохранении
        document.getElementById('single-panel').dataset.dbKey = dbKey;
        document.getElementById('single-panel').dataset.rowIndex = rowIndex;
        document.getElementById('single-panel').dataset.colIndex = colIndex;
        document.getElementById('single-panel').dataset.taskNumber = taskNumber;
        
        // Показываем уведомление
        showNotification('המשימה נטענה לעריכה. שנה את הנתונים ולחץ על "שמור משימה"');
      }

      function showNotification(message) {
        // Создаем уведомление
        const notification = document.createElement('div');
        notification.className = 'notification';
        notification.textContent = message;
        notification.style.cssText = `
          position: fixed;
          top: 20px;
          right: 20px;
          background-color: #83a737;
          color: white;
          padding: 12px 20px;
          border-radius: 6px;
          font-size: 14px;
          font-weight: bold;
          z-index: 10000;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
          animation: slideIn 0.3s ease;
        `;
        
        document.body.appendChild(notification);
        
        // Удаляем уведомление через 3 секунды
        setTimeout(() => {
          notification.style.animation = 'slideOut 0.3s ease';
          setTimeout(() => {
            if (notification.parentNode) {
              notification.parentNode.removeChild(notification);
            }
          }, 300);
        }, 3000);
      }

      async function deleteTask(dateRange, rowIndex, colIndex, taskNumber, isTeamWork = false, teamColor = null) {
        try {
          console.log('Delete task params:', { dateRange, rowIndex, colIndex, taskNumber, isTeamWork, teamColor });
          
          if (!dateRange || rowIndex === undefined || colIndex === undefined || taskNumber === undefined) {
            console.error('Missing required parameters for delete');
            return;
          }

          if (!confirm('האם אתה בטוח שברצונך למחוק את המשימה?')) {
            return;
          }

          // Удаляем основную задачу
          const dbKey = `notes/${dateRange}/${rowIndex}/${colIndex}/${taskNumber}`;
          console.log('Deleting task at:', dbKey);
          await set(ref(db, dbKey), null);

          // Если это командная работа, нужно найти и удалить задачу напарника
          if (isTeamWork && teamColor) {
            for (let otherColIndex = 0; otherColIndex < names.length; otherColIndex++) {
              if (otherColIndex !== colIndex) {
                const otherKey = `notes/${dateRange}/${rowIndex}/${otherColIndex}/${taskNumber}`;
                const snapshot = await get(ref(db, otherKey));
                const data = snapshot.val();
                if (data && data.teamColor === teamColor) {
                  console.log('Deleting team task at:', otherKey);
                  await set(ref(db, otherKey), null);
                }
              }
            }
          }
          
          showNotification('המשימה נמחקה בהצלחה');
          closeTaskFullScreen();
          // Перезагружаем задачи для обновления отображения
          reloadTasksForWeek();
        } catch (error) {
          console.error("Error deleting task:", error);
          alert("שגיאה במחיקת המשימה");
        }
      }

      function showTaskFullScreen(taskText, taskData = null) {
        if (!taskText.trim()) {
          return;
        }

        const fullScreenOverlay = document.createElement('div');
        fullScreenOverlay.id = 'task-fullscreen-overlay';
        fullScreenOverlay.style.cssText = `
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background-color: rgba(0, 0, 0, 0.9);
          display: flex;
          justify-content: center;
          align-items: center;
          z-index: 10000;
          direction: rtl;
        `;

        const fullScreenContent = document.createElement('div');
        fullScreenContent.id = 'task-fullscreen-content';
        fullScreenContent.style.cssText = `
          background-color: white;
          border-radius: 12px;
          padding: 30px;
          max-width: 90%;
          max-height: 90%;
          overflow-y: auto;
          box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
          position: relative;
        `;

        const lines = taskText.split(/[\r\n]+/);
        const formattedContent = lines
          .map((line) => {
            if (line.match(/טלפון \d+:/)) {
              const phoneMatch = line.match(/טלפון \d+: ([^,]+), שם: (.*)/);
              if (phoneMatch) {
                const phoneNumber = phoneMatch[1].trim();
                return `<div class="task-line phone-line">
                  <span>${line}</span>
                  <a href="tel:${phoneNumber}" class="call-phone-btn">📞</a>
                </div>`;
              }
            }
            return `<div class="task-line">${line.trim()}</div>`;
          })
          .join("");

        // Сохраняем данные задачи в переменной для использования в обработчике
        const taskInfo = taskData ? {
          dateRange: taskData.dateRange,
          rowIndex: taskData.rowIndex,
          colIndex: taskData.colIndex,
          taskNumber: taskData.taskNumber,
          isTeamWork: taskData.isTeamWork,
          teamColor: taskData.teamColor || ''
        } : null;

        const deleteButtonHandler = taskInfo ? 
          `onclick="deleteTask('${taskInfo.dateRange}', ${taskInfo.rowIndex}, ${taskInfo.colIndex}, ${taskInfo.taskNumber}, ${taskInfo.isTeamWork}, '${taskInfo.teamColor}')"` :
          '';

        const headerContent = `
          <div class="task-fullscreen-header">
            <h2>פרטי המשימה</h2>
            <div class="task-fullscreen-actions">
              ${isAdmin.status && taskInfo ? `
                <button class="delete-task-btn" ${deleteButtonHandler}>
                  🗑️ מחק משימה
                </button>
              ` : ''}
              <button class="close-fullscreen-btn" onclick="closeTaskFullScreen()">✕</button>
            </div>
          </div>
        `;

        fullScreenContent.innerHTML = `
          ${headerContent}
          <div class="task-fullscreen-body">
            ${formattedContent}
          </div>
        `;

        fullScreenOverlay.appendChild(fullScreenContent);
        document.body.appendChild(fullScreenOverlay);

        fullScreenOverlay.addEventListener('click', (e) => {
          if (e.target === fullScreenOverlay) {
            closeTaskFullScreen();
          }
        });

        document.addEventListener('keydown', function closeOnEscape(e) {
          if (e.key === 'Escape') {
            closeTaskFullScreen();
            document.removeEventListener('keydown', closeOnEscape);
          }
        });
      }

      // Делаем функции глобальными
      window.closeTaskFullScreen = closeTaskFullScreen;
      window.deleteTask = deleteTask;

      function clearAllFields() {
        // Clear main fields
        document.getElementById('target-name').value = '';
        document.getElementById('target-day').value = '';
        document.getElementById('target-number').value = '';
        document.getElementById('task-address').value = '';
        document.getElementById('task-reason').value = '';
        document.getElementById('task-comments').value = '';
        
        // Clear code entry fields
        document.getElementById('code-entry').value = '';
        document.getElementById('code-entry-option').value = '';
        document.getElementById('no-code-entry').checked = false;
        document.getElementById('code-entry').style.display = 'block';
        document.getElementById('code-entry-options').style.display = 'none';
        
        // Clear team work fields
        document.getElementById('team-work').checked = false;
        document.getElementById('target-name-2').value = '';
        document.getElementById('target-name-2-container').style.display = 'none';
        
        // Clear phone entries except the first one
        const phoneList = document.getElementById('phone-list');
        while (phoneList.children.length > 1) {
          phoneList.removeChild(phoneList.lastChild);
        }
        // Clear the first phone entry
        const firstPhoneEntry = phoneList.firstChild;
        if (firstPhoneEntry) {
          firstPhoneEntry.querySelector('.phone-number').value = '';
          firstPhoneEntry.querySelector('.phone-name').value = '';
        }
        
        // Clear task data from the form
        document.getElementById('single-panel').dataset.dbKey = '';
        document.getElementById('single-panel').dataset.rowIndex = '';
        document.getElementById('single-panel').dataset.colIndex = '';
        document.getElementById('single-panel').dataset.taskNumber = '';
        
        showNotification('כל השדות נוקו');
      }

      // === Печать задач ===
      document.getElementById('print-day-tasks').addEventListener('click', () => {
        document.getElementById('print-modal').style.display = 'flex';
      });
      document.getElementById('print-modal-cancel').addEventListener('click', () => {
        document.getElementById('print-modal').style.display = 'none';
      });
      document.getElementById('print-modal-confirm').addEventListener('click', async () => {
        const dayIndex = parseInt(document.getElementById('print-day-select').value);
        const name = document.getElementById('print-name-select').value;
        const printCode = document.getElementById('print-code-checkbox').checked;
        const printPhone = document.getElementById('print-phone-checkbox').checked;
        const printComments = document.getElementById('print-comments-checkbox').checked;
        document.getElementById('print-modal').style.display = 'none';
        await printTasksForDayAndName(dayIndex, name, { printCode, printPhone, printComments });
      });

      // === Замена задач ===
      document.getElementById('swap-tasks').addEventListener('click', () => {
        document.getElementById('swap-modal').style.display = 'flex';
      });
      document.getElementById('swap-modal-cancel').addEventListener('click', () => {
        document.getElementById('swap-modal').style.display = 'none';
      });
      document.getElementById('swap-modal-confirm').addEventListener('click', async () => {
        const day1Index = parseInt(document.getElementById('swap-day1-select').value);
        const name1 = document.getElementById('swap-name1-select').value;
        const task1 = parseInt(document.getElementById('swap-task1-select').value);
        
        const day2Index = parseInt(document.getElementById('swap-day2-select').value);
        const name2 = document.getElementById('swap-name2-select').value;
        const task2 = parseInt(document.getElementById('swap-task2-select').value);
        
        // Проверяем, что выбраны разные задачи
        if (day1Index === day2Index && name1 === name2 && task1 === task2) {
          alert('נא לבחור שתי משימות שונות');
          return;
        }
        
        document.getElementById('swap-modal').style.display = 'none';
        await swapTasks(day1Index, name1, task1, day2Index, name2, task2);
      });

      // === Печать задач для выбранного дня и сотрудника ===
      async function printTasksForDayAndName(dayIndex, name, opts = { printCode: true, printPhone: true, printComments: true }) {
        const { printCode, printPhone, printComments } = opts;
        const { dateRange, sunday } = getWeekDateRange(weekOffset);
        const dayNames = ["ראשון", "שני", "שלישי", "רביעי", "חמישי"];
        const names = ["טימור", "יעקב", "עופר", "טכנאי ביצוע"];
        const taskNumbers = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10];
        const colIndex = names.indexOf(name);
        if (colIndex === -1) {
          alert('שם לא תקין');
          return;
        }
        // Получаем дату дня
        const date = new Date(sunday);
        date.setDate(sunday.getDate() + dayIndex);
        const dd = String(date.getDate()).padStart(2, "0");
        const mm = String(date.getMonth() + 1).padStart(2, "0");
        const yyyy = date.getFullYear();
        const dayLabel = dayNames[dayIndex];
        const dateLabel = `${dd}.${mm}.${yyyy}`;

        // Собираем задачи
        let tasks = [];
        for (let taskNum of taskNumbers) {
          const dbKey = `notes/${dateRange}/${dayIndex}/${colIndex}/${taskNum}`;
          // eslint-disable-next-line no-await-in-loop
          const snapshot = await get(ref(db, dbKey));
          const data = snapshot.val();
          if (data && (data.address || data.reason)) {
            tasks.push({ ...data, taskNumber: taskNum });
          }
        }
        if (tasks.length === 0) {
          alert('אין משימות לאותו יום ולעובד שנבחר');
          return;
        }

        // Формируем HTML для печати
        let printHtml = `
          <html lang="he" dir="rtl">
          <head>
            <meta charset="UTF-8">
            <title>משימות להדפסה</title>
            <style>
              body { font-family: sans-serif; direction: rtl; margin: 0; padding: 0; }
              .print-header { text-align: center; font-size: 1.25em; font-weight: bold; margin-top: 18px; margin-bottom: 6px; }
              .print-logo { display: block; margin: 8px auto 10px auto; max-width: 140px; }
              .tasks-list { max-width: 600px; margin: 0 auto; }
              .task-print-block { margin: 16px 0; padding: 4px 0 2px 0; box-sizing: border-box; page-break-inside: avoid; border: none; border-radius: 0; min-height: 38px; }
              .task-field { margin-bottom: 3px; font-size: 0.98em; }
              .task-label { font-weight: bold; }
              @media print {
                .task-print-block { page-break-inside: avoid; }
              }
            </style>
          </head>
          <body>
            <div class="print-header">${name} — ${dateLabel} — ${dayLabel}</div>
            <img src="utech.jpg" alt="Utech Logo" class="print-logo" />
            <div class="tasks-list">
        `;
        tasks.slice(0, 10).forEach((task) => {
          printHtml += `<div class="task-print-block">`;
          printHtml += `<div class="task-field"><span class="task-label">כתובת:</span> ${task.address || ''}</div>`;
          printHtml += `<div class="task-field"><span class="task-label">משימה:</span> ${task.reason || ''}</div>`;
          if (printCode) {
            printHtml += `<div class="task-field"><span class="task-label">קוד:</span> ${task.code || ''}</div>`;
          }
          if (printPhone) {
            printHtml += `<div class="task-field"><span class="task-label">טלפון${task.phones && task.phones.length > 1 ? 'ים' : ''}:</span><br>
              ${(task.phones || []).map((p, i) => `טלפון ${i + 1}: ${p.phone || ''}, שם: ${p.name || ''}`).join('<br>')}
            </div>`;
          }
          if (printComments) {
            printHtml += `<div class="task-field"><span class="task-label">הערות:</span> ${task.comments || ''}</div>`;
          }
          printHtml += `</div>`;
        });
        printHtml += '</div></body></html>';

        // Открываем новое окно и печатаем
        const printWindow = window.open('', '_blank');
        printWindow.document.open();
        printWindow.document.write(printHtml);
        printWindow.document.close();
        printWindow.focus();
        setTimeout(() => {
          printWindow.print();
          // printWindow.close(); // Можно раскомментировать для автозакрытия
        }, 500);
      }

      // === Замена задач между разными днями и сотрудниками ===
      async function swapTasks(day1Index, name1, task1, day2Index, name2, task2) {
        const { dateRange } = getWeekDateRange(weekOffset);
        const names = ["טימור", "יעקב", "עופר", "טכנאי ביצוע"];
        const col1Index = names.indexOf(name1);
        const col2Index = names.indexOf(name2);
        
        if (col1Index === -1 || col2Index === -1) {
          alert('שם לא תקין');
          return;
        }

        try {
          // Получаем данные обеих задач
          const task1Key = `notes/${dateRange}/${day1Index}/${col1Index}/${task1}`;
          const task2Key = `notes/${dateRange}/${day2Index}/${col2Index}/${task2}`;
          
          const task1Snapshot = await get(ref(db, task1Key));
          const task2Snapshot = await get(ref(db, task2Key));
          
          const task1Data = task1Snapshot.val();
          const task2Data = task2Snapshot.val();

          // Проверяем, что хотя бы одна задача существует
          if (!task1Data && !task2Data) {
            alert('לא נמצאו משימות להחלפה');
            return;
          }

          // Меняем местами задачи
          if (task1Data) {
            await set(ref(db, task2Key), task1Data);
          } else {
            await set(ref(db, task2Key), null);
          }
          
          if (task2Data) {
            await set(ref(db, task1Key), task2Data);
          } else {
            await set(ref(db, task1Key), null);
          }

          // Если это командные задачи, нужно обновить и задачи напарников
          if (task1Data && task1Data.teamColor) {
            // Находим и обновляем задачу напарника для task1
            for (let otherColIndex = 0; otherColIndex < names.length; otherColIndex++) {
              if (otherColIndex !== col1Index) {
                const otherTask1Key = `notes/${dateRange}/${day1Index}/${otherColIndex}/${task1}`;
                const otherTask1Snapshot = await get(ref(db, otherTask1Key));
                const otherTask1Data = otherTask1Snapshot.val();
                
                if (otherTask1Data && otherTask1Data.teamColor === task1Data.teamColor) {
                  // Удаляем задачу напарника с первого места
                  await set(ref(db, otherTask1Key), null);
                  
                  // Добавляем задачу напарника на второе место
                  const otherTask2Key = `notes/${dateRange}/${day2Index}/${otherColIndex}/${task2}`;
                  await set(ref(db, otherTask2Key), otherTask1Data);
                }
              }
            }
          }
          
          if (task2Data && task2Data.teamColor) {
            // Находим и обновляем задачу напарника для task2
            for (let otherColIndex = 0; otherColIndex < names.length; otherColIndex++) {
              if (otherColIndex !== col2Index) {
                const otherTask2Key = `notes/${dateRange}/${day2Index}/${otherColIndex}/${task2}`;
                const otherTask2Snapshot = await get(ref(db, otherTask2Key));
                const otherTask2Data = otherTask2Snapshot.val();
                
                if (otherTask2Data && otherTask2Data.teamColor === task2Data.teamColor) {
                  // Удаляем задачу напарника со второго места
                  await set(ref(db, otherTask2Key), null);
                  
                  // Добавляем задачу напарника на первое место
                  const otherTask1Key = `notes/${dateRange}/${day1Index}/${otherColIndex}/${task1}`;
                  await set(ref(db, otherTask1Key), otherTask2Data);
                }
              }
            }
          }

          showNotification('המשימות הוחלפו בהצלחה');
          
          // Перезагружаем задачи для обновления отображения
          reloadTasksForWeek();
          
        } catch (error) {
          console.error("Error swapping tasks:", error);
          alert("שגיאה בהחלפת המשימות");
        }
      }

      // ... существующий код ...
      // В обработчике single-insert вызываю debounceSaveTask без передачи reloadTasksForWeek и showNotification.
      // ... существующий код ...

    </script>
    <script>

      // Глобальная функция для закрытия полноэкранного режима
      function closeTaskFullScreen() {
        const overlay = document.getElementById('task-fullscreen-overlay');
        if (overlay) {
          overlay.remove();
        }
      }
    </script>
  </head>
  <body>
    <img src="utech.jpg" alt="Utech Logo" class="header-image" />
    <div style="display: flex; align-items: center; justify-content: center; margin-bottom: 10px;">
      <button id="next-week" style="font-size: 1em; margin: 0 5px; padding: 2px 8px;">→</button>
      <span id="week-range" style="font-weight: bold; min-width: 140px; text-align: center;"></span>
      <button id="prev-week" style="font-size: 1em; margin: 0 5px; padding: 2px 8px;">←</button>
    </div>
    <select id="day-select">
      <option value="0">ראשון</option>
      <option value="1">שני</option>
      <option value="2">שלישי</option>
      <option value="3">רביעי</option>
      <option value="4">חמישי</option>
    </select>
    <table id="schedule-table">
      <thead>
        <tr>
          <th class="day">יום</th>
          <th id="name-0">טימור</th>
          <th id="name-1">יעקב</th>
          <th id="name-2">עופר</th>
          <th id="name-3">טכנאי ביצוע</th>
          <th class="day-notes-header">הערות</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>ראשון</td>
          <td class="cell"></td>
          <td class="cell"></td>
          <td class="cell"></td>
          <td class="cell"></td>
          <td class="day-notes-cell"></td>
        </tr>
        <tr>
          <td>שני</td>
          <td class="cell"></td>
          <td class="cell"></td>
          <td class="cell"></td>
          <td class="cell"></td>
          <td class="day-notes-cell"></td>
        </tr>
        <tr>
          <td>שלישי</td>
          <td class="cell"></td>
          <td class="cell"></td>
          <td class="cell"></td>
          <td class="cell"></td>
          <td class="day-notes-cell"></td>
        </tr>
        <tr>
          <td>רביעי</td>
          <td class="cell"></td>
          <td class="cell"></td>
          <td class="cell"></td>
          <td class="cell"></td>
          <td class="day-notes-cell"></td>
        </tr>
        <tr>
          <td>חמישי</td>
          <td class="cell"></td>
          <td class="cell"></td>
          <td class="cell"></td>
          <td class="cell"></td>
          <td class="day-notes-cell"></td>
        </tr>
        <tr class="bottom-names-row">
          <td></td>
          <td>טימור</td>
          <td>יעקב</td>
          <td>עופר</td>
          <td>טכנאי ביצוע</td>
          <td></td>
        </tr>
      </tbody>
    </table>

    <div id="single-panel">
      <label
        >שם:<span class="required">*</span>
        <div class="team-work-row">
          <select id="target-name" required>
            <option value="">בחר שם</option>
            <option>טימור</option>
            <option>יעקב</option>
            <option>עופר</option>
            <option>טכנאי ביצוע</option>
          </select>
          <div class="checkbox-container">
            <input type="checkbox" id="team-work" />
            <label for="team-work">עבודת צוות</label>
          </div>
        </div>
      </label>
      <div id="target-name-2-container">
        <label
          >שם שני:<span class="required">*</span>
          <div class="team-work-row">
            <select id="target-name-2" required>
              <option value="">בחר שם</option>
              <option>טימור</option>
              <option>יעקב</option>
              <option>עופר</option>
              <option>טכנאי ביצוע</option>
            </select>
          </div>
        </label>
      </div>
      <label
        >יום:<span class="required">*</span>
        <select id="target-day" required>
          <option value="">בחר יום</option>
          <option value="0">ראשון</option>
          <option value="1">שני</option>
          <option value="2">שלישי</option>
          <option value="3">רביעי</option>
          <option value="4">חמישי</option>
        </select>
      </label>
      <label style="display: flex; flex-direction: column; align-items: flex-start; gap: 2px;">
        <span>מספר משימה:<span class="required">*</span></span>
        <div style="display: flex; align-items: center; gap: 8px;">
          <select id="target-number" required style="width: 370px;">
            <option value="">בחר מספר</option>
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="7">7</option>
            <option value="8">8</option>
            <option value="9">9</option>
            <option value="10">10</option>
          </select>
          <div class="checkbox-container" style="display: flex; align-items: center; gap: 4px;">
            <input type="checkbox" id="insert-between-checkbox" />
            <label for="insert-between-checkbox" style="font-size: 0.95em;">הוספה בין משימות</label>
          </div>
        </div>
      </label>
      <div id="insert-between-fields"
           style="display: none; margin-bottom: 8px; gap: 8px; flex-direction: row; align-items: center; font-size: 0.95em;">
        <span>בין</span>
        <select id="between-task1" style="width: 48px; min-width: 48px;">
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
          <option value="6">6</option>
          <option value="7">7</option>
          <option value="8">8</option>
          <option value="9">9</option>
        </select>
        <span>ו</span>
        <select id="between-task2" style="width: 48px; min-width: 48px;">
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
          <option value="6">6</option>
          <option value="7">7</option>
          <option value="8">8</option>
          <option value="9">9</option>
          <option value="10">10</option>
        </select>
      </div>
      <label
        >כתובת:<span class="required">*</span>
        <input type="text" id="task-address" required placeholder="📬 הזן כתובת" />
      </label>
      <div id="codes-section">
        <label>קוד:<span class="required">*</span></label>
        <label
          >כניסה:
          <div class="code-row">
            <input type="text" id="code-entry" placeholder="🔑 הזן קוד כניסה" />
            <div class="checkbox-container">
              <input type="checkbox" id="no-code-entry" />
              <label for="no-code-entry">אין קוד</label>
            </div>
          </div>
          <div class="code-options" id="code-entry-options">
            <select id="code-entry-option" class="code-option-select">
              <option value="">בחר אפשרות</option>
              <option value="יש שומר">יש שומר</option>
              <option value="אין קודן / דלת פתוחה">אין קודן / דלת פתוחה</option>
            </select>
          </div>
        </label>
      </div>
      <label>טלפון:<span class="required">*</span></label>
      <div id="phone-list">
        <div class="phone-entry">
          <input type="tel" class="phone-number" placeholder="📞 הזן מספר טלפון"
          " required />
          <input
            type="text"
            class="phone-name"
            placeholder="🙍‍♂️ שם איש קשר"
            required
          />
        </div>
      </div>
      <button id="add-phone">+</button>
      <label
        >משימה:<span class="required">*</span>
        <textarea
          id="task-reason"
          required
          placeholder="📰 הזן משימה"
          rows="3"
        ></textarea>
      </label>
      <label
        >הערות:
        <textarea
          id="task-comments"
          placeholder="📎 הזן הערות"
        ></textarea>
      </label>
      <button id="single-insert">�� שמור משימה</button>
      <button id="clear-all-fields">🗑️ נקה את כל השדות</button>
      <button id="print-day-tasks">🖨️ הדפס משימות</button>
      <button id="swap-tasks">🔄 החלף משימות</button>
    </div>

    <div id="task-overlay">
      <div id="task-overlay-content"></div>
    </div>

    <div id="back-confirm-overlay">
      <div id="back-confirm-content">
        <p>לחץ שוב על "חזור" כדי לצאת</p>
        <button id="back-cancel">ביטול</button>
      </div>
    </div>

    <!-- Модальное окно выбора дня и сотрудника для печати -->
    <div id="print-modal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.5); z-index:20000; justify-content:center; align-items:center;">
      <div style="background:#fff; padding:24px; border-radius:10px; min-width:260px; max-width:90vw;">
        <h3 style="margin-top:0;">בחר יום ועובד להדפסה</h3>
        <label>יום:
          <select id="print-day-select">
            <option value="0">ראשון</option>
            <option value="1">שני</option>
            <option value="2">שלישי</option>
            <option value="3">רביעי</option>
            <option value="4">חמישי</option>
          </select>
        </label>
        <label>עובד:
          <select id="print-name-select">
            <option value="טימור">טימור</option>
            <option value="יעקב">יעקב</option>
            <option value="עופר">עופר</option>
            <option value="טכנאי ביצוע">טכנאי ביצוע</option>
          </select>
        </label>
        <div style="margin: 12px 0 8px 0; display: flex; flex-direction: column; align-items: center;">
          <label style="margin-bottom: 6px; text-align: center; width: 100%;"><input type="checkbox" id="print-code-checkbox"> קוד</label>
          <label style="margin-bottom: 6px; text-align: center; width: 100%;"><input type="checkbox" id="print-phone-checkbox"> טלפון + שם</label>
          <label style="text-align: center; width: 100%;"><input type="checkbox" id="print-comments-checkbox"> הערות</label>
        </div>
        <div style="display:flex; gap:10px; margin-top:16px;">
          <button id="print-modal-confirm">הדפס</button>
          <button id="print-modal-cancel">ביטול</button>
        </div>
      </div>
    </div>

    <!-- Модальное окно замены задач -->
    <div id="swap-modal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.5); z-index:20000; justify-content:center; align-items:center;">
      <div style="background:#fff; padding:24px; border-radius:10px; min-width:300px; max-width:90vw;">
        <h3 style="margin-top:0;">החלף משימות</h3>
        <div style="display:flex; gap:20px; margin-bottom:15px;">
          <div style="flex:1;">
            <h4 style="margin:0 0 10px 0; color:#333;">משימה ראשונה</h4>
            <label>יום:
              <select id="swap-day1-select">
                <option value="0">ראשון</option>
                <option value="1">שני</option>
                <option value="2">שלישי</option>
                <option value="3">רביעי</option>
                <option value="4">חמישי</option>
              </select>
            </label>
            <label>עובד:
              <select id="swap-name1-select">
                <option value="טימור">טימור</option>
                <option value="יעקב">יעקב</option>
                <option value="עופר">עופר</option>
                <option value="טכנאי ביצוע">טכנאי ביצוע</option>
              </select>
            </label>
            <label>מספר משימה:
              <select id="swap-task1-select">
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
                <option value="9">9</option>
                <option value="10">10</option>
              </select>
            </label>
          </div>
          <div style="flex:1;">
            <h4 style="margin:0 0 10px 0; color:#333;">משימה שנייה</h4>
            <label>יום:
              <select id="swap-day2-select">
                <option value="0">ראשון</option>
                <option value="1">שני</option>
                <option value="2">שלישי</option>
                <option value="3">רביעי</option>
                <option value="4">חמישי</option>
              </select>
            </label>
            <label>עובד:
              <select id="swap-name2-select">
                <option value="טימור">טימור</option>
                <option value="יעקב">יעקב</option>
                <option value="עופר">עופר</option>
                <option value="טכנאי ביצוע">טכנאי ביצוע</option>
              </select>
            </label>
            <label>מספר משימה:
              <select id="swap-task2-select">
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
                <option value="9">9</option>
                <option value="10">10</option>
              </select>
            </label>
          </div>
        </div>
        <div style="display:flex; gap:10px; margin-top:16px;">
          <button id="swap-modal-confirm">החלף</button>
          <button id="swap-modal-cancel">ביטול</button>
        </div>
      </div>
    </div>
  </body>
</html>
<style>
  body {
    font-family: sans-serif;
    padding: 20px;
    background: #ffffff;
    margin: 0;
    position: relative;
  }
  .header-image {
    width: 100%;
    max-width: 300px;
    height: auto;
    object-fit: contain;
    display: block;
    margin: 10px auto;
  }
  table {
    border-collapse: collapse;
    width: 100%;
    max-width: 100%;
    margin: 10px 0;
  }
  th,
  td {
    border: 1px solid #ccc;
    padding: 8px;
    text-align: center;
    vertical-align: top;
    position: relative;
  }
  th {
    background: #83a737;
    color: white;
  }
  .today {
    background: #965fa9 !important;
    color: rgb(255, 255, 255);
  }
  th.name {
    background: #fc9247;
  }
  .checkboxes label {
    display: inline-block;
    margin: 0 2px;
    position: relative;
    font-weight: bold;
    padding: 2px;
    border: none;
    min-width: 22px;
    text-align: center;
  }
  .no-task {
    color: black;
  }
  .has-task {
    color: #ff0000;
  }
  .completed {
    color: #008000;
  }
  .team_cyan {
    color: #00ced1;
    border: 1px solid #00ced1;
    border-radius: 3px;
  }
  .tooltip {
    display: none;
    position: absolute;
    bottom: 100%;
    right: 0;
    background: #fff;
    border: 1px solid #ccc;
    padding: 8px;
    z-index: 10;
    max-width: 200px;
    white-space: pre-line;
    font-size: 0.9em;
  }
  label:hover .tooltip {
    display: block;
  }
  #day-select {
    display: block;
    margin: 10px auto;
    padding: 5px;
    font-size: 1em;
    width: 200px;
  }
  #admin-button {
    display: block;
    margin: 10px auto;
    padding: 8px 12px;
    font-size: 0.9em;
    background: #83a737;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
  }
  #admin-panel,
  #single-panel {
    display: none;
    position: relative;
    background: white;
    border: 1px solid #ccc;
    padding: 15px;
    width: 100%;
    max-width: 100%;
    margin: 10px 0;
    box-sizing: border-box;
    z-index: 100;
  }
  textarea,
  input,
  select {
    width: 100%;
    margin-bottom: 8px;
    padding: 5px;
    font-size: 0.9em;
  }
  button {
    padding: 8px;
    font-size: 0.9em;
    width: 100%;
    margin-bottom: 5px;
  }
  .required {
    color: red;
  }
  #phone-list {
    margin-bottom: 5px;
  }
  .phone-entry {
    display: flex;
    align-items: center;
    margin-bottom: 8px;
  }
  .phone-number {
    width: 65%;
    margin-left: 5px;
  }
  .phone-name {
    width: 35%;
  }
  #add-phone {
    display: block;
    padding: 5px;
    font-size: 1em;
    width: auto;
    background: #83a737;
    color: white;
    border: none;
    border-radius: 4px;
    margin: 5px 0;
  }
  .remove-phone {
    padding: 5px;
    font-size: 1em;
    width: auto;
    background: #ff4444;
    color: white;
    border: none;
    border-radius: 4px;
    margin-right: 5px;
  }
  #task-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    z-index: 200;
    justify-content: center;
    align-items: center;
  }
  #task-overlay-content {
    background: #fff;
    padding: 20px;
    max-width: 90%;
    max-height: 80%;
    overflow-y: auto;
    font-size: 1.5em;
    text-align: right;
    border-radius: 8px;
    white-space: pre-line;
    line-height: 2;
  }
  #task-overlay-content p {
    margin: 0 0 15px 0;
    direction: rtl;
    display: flex;
    align-items: center;
    justify-content: flex-end;
  }
  .call-phone {
    display: none;
    width: auto;
    height: auto;
    padding: 0;
    font-size: 1em;
    background: none;
    border: none;
    cursor: pointer;
    margin-right: 5px;
    line-height: 1;
    text-align: center;
    text-decoration: none;
    color: black;
  }
  #back-confirm-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    z-index: 300;
    justify-content: center;
    align-items: center;
  }
  #back-confirm-content {
    background: #fff;
    padding: 20px;
    max-width: 90%;
    text-align: center;
    border-radius: 8px;
    font-size: 1.2em;
  }
  #back-cancel {
    margin-top: 10px;
    padding: 8px 16px;
    font-size: 1em;
    background: #83a737;
    color: #fff;
    border: none;
    border-radius: 4px;
    cursor: pointer;
  }
  #codes-section {
    margin-bottom: 8px;
  }
  #codes-section label {
    display: block;
    margin-bottom: 2px;
  }
  .code-row {
    display: flex;
    align-items: center;
    margin-bottom: 2px;
  }
  .code-row input[type="text"] {
    width: 60%;
    padding: 3px;
    font-size: 0.9em;
    margin-left: 5px;
  }
  .checkbox-container {
    width: 40%;
    display: flex;
    flex-direction: column;
    align-items: center;
    margin: 0;
    text-align: center;
  }
  .checkbox-container input[type="checkbox"] {
    margin: 0;
  }
  .checkbox-container label {
    font-size: 0.9em;
    margin-top: 1px;
    line-height: 1;
  }
  .code-options {
    display: none;
    margin-top: -27px;
    margin-bottom: 2px;
    padding-right: 40%;
  }
  .code-options select {
    width: 60%;
    font-size: 0.8em;
    padding: 3px;
    margin-left: 5px;
  }
  .team-work-row {
    display: flex;
    align-items: center;
    margin-bottom: 8px;
  }
  .team-work-row select {
    width: 60%;
    padding: 5px;
    font-size: 0.9em;
    margin-left: 5px;
  }
  #target-name-2-container {
    display: none;
    margin-bottom: 8px;
  }

  @media (max-width: 600px) {
    body {
      padding: 10px;
    }
    .header-image {
      max-width: 150px;
      margin: 5px auto;
    }
    table {
      font-size: 0.85em;
    }
    th,
    td {
      padding: 5px;
    }
    .checkboxes label {
      margin: 0 1px;
    }
    .tooltip {
      max-width: 150px;
      font-size: 0.8em;
    }
    #day-select {
      width: 150px;
      font-size: 0.9em;
    }
    #admin-button,
    #admin-panel {
      display: none;
    }
    #single-panel {
      padding: 10px;
    }
    .call-phone {
      display: inline-block;
    }
    .phone-number {
      width: 60%;
    }
    .phone-name {
      width: 40%;
    }
    .code-row input[type="text"] {
      width: 55%;
    }
    .checkbox-container {
      width: 45%;
    }
    .checkbox-container label {
      font-size: 0.85em;
    }
    .code-options select {
      width: 55%;
    }
    .team-work-row select {
      width: 55%;
    }
    
    /* Мобильные стили для заметок дней */
    .day-notes-textarea {
      min-height: 50px;
      font-size: 0.8em;
      padding: 6px;
      padding-right: 35px; /* Место для кнопки на мобильных */
    }
    
    .day-notes-cell {
      padding: 4px !important;
    }
    
    .day-notes-save-btn {
      width: 20px;
      height: 20px;
      top: 6px;
      right: 6px;
      font-size: 10px;
    }
    
    /* На мобильных скрываем заголовок заметок */
    .day-notes-header {
      display: none !important;
    }
    
    /* Мобильные стили для мобильной строки заметок */
    .mobile-notes-textarea {
      width: 100%;
      min-height: 60px;
      padding: 8px;
      padding-right: 40px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 0.9em;
      font-family: inherit;
      resize: vertical;
      background-color: #fff;
      box-sizing: border-box;
    }
    
    .mobile-notes-cell {
      padding: 4px !important;
    }
    
    .mobile-notes-save-btn {
      position: absolute;
      top: 8px;
      right: 8px;
      width: 24px;
      height: 24px;
      border: none;
      border-radius: 4px;
      background-color: #83a737;
      color: white;
      cursor: pointer;
      font-size: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background-color 0.2s ease;
    }
    
    .mobile-notes-save-btn:hover {
      background-color: #6b8a2a;
    }
  }

  @media (min-width: 601px) {
    #day-select {
      display: none;
    }
    .checkboxes input[type="checkbox"]:disabled {
      opacity: 1;
      cursor: default;
    }
  }
  /* Стили для заметок дней */
  .day-notes-row {
    background-color: #f8f9fa;
  }
  
  .day-notes-header {
    background-color: white !important;
    color: black !important;
    font-weight: bold;
    text-align: center;
    padding: 8px !important;
    vertical-align: middle;
  }
  
  .day-notes-cell {
    padding: 8px !important;
    vertical-align: top;
  }
  
  .day-notes-container {
    width: 100%;
    position: relative;
  }
  
  .day-notes-textarea {
    width: 100%;
    min-height: 60px;
    padding: 8px;
    padding-right: 40px; /* Место для кнопки */
    border: 1px solid #ddd;
    border-radius: 4px;
    font-size: 0.85em;
    font-family: inherit;
    resize: vertical;
    background-color: #fff;
    box-sizing: border-box;
  }
  
  .day-notes-textarea:focus {
    outline: none;
    border-color: #83a737;
    box-shadow: 0 0 0 2px rgba(131, 167, 55, 0.2);
  }
  
  .day-notes-textarea::placeholder {
    color: #999;
    font-style: italic;
  }
  
  .day-notes-save-btn {
    position: absolute;
    top: 8px;
    right: 8px;
    width: 24px;
    height: 24px;
    border: none;
    border-radius: 4px;
    background-color: #83a737;
    color: white;
    cursor: pointer;
    font-size: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background-color 0.2s ease;
  }
  
  .day-notes-save-btn:hover {
    background-color: #6b8a2a;
  }
  
  .day-notes-save-btn:active {
    transform: scale(0.95);
  }

  /* Стили для мобильной строки заметок */
  .mobile-notes-row {
    background-color: #f8f9fa;
  }
  
  .mobile-notes-cell {
    padding: 8px !important;
    vertical-align: top;
  }
  
  .mobile-notes-container {
    width: 100%;
    position: relative;
  }
  
  .mobile-notes-textarea {
    width: 100%;
    min-height: 60px;
    padding: 8px;
    padding-right: 40px;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-size: 0.9em;
    font-family: inherit;
    resize: vertical;
    background-color: #fff;
    box-sizing: border-box;
  }
  
  .mobile-notes-textarea:focus {
    outline: none;
    border-color: #83a737;
    box-shadow: 0 0 0 2px rgba(131, 167, 55, 0.2);
  }
  
  .mobile-notes-save-btn {
    position: absolute;
    top: 8px;
    right: 8px;
    width: 24px;
    height: 24px;
    border: none;
    border-radius: 4px;
    background-color: #83a737;
    color: white;
    cursor: pointer;
    font-size: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background-color 0.2s ease;
  }
  
  .mobile-notes-save-btn:hover {
    background-color: #6b8a2a;
  }

  /* Стили для модального окна редактирования */
  #edit-task-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 10000;
  }

  #edit-task-modal-content {
    background-color: white;
    border-radius: 12px;
    padding: 20px;
    max-width: 90%;
    max-height: 90%;
    overflow-y: auto;
    direction: rtl;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
  }

  #edit-task-modal-content h2 {
    text-align: center;
    margin-bottom: 20px;
    color: #333;
    font-size: 1.5em;
  }

  #edit-single-panel {
    display: flex;
    flex-direction: column;
    gap: 15px;
  }

  #edit-single-panel label {
    display: flex;
    flex-direction: column;
    gap: 5px;
    font-weight: bold;
    color: #333;
  }

  #edit-single-panel input,
  #edit-single-panel select,
  #edit-single-panel textarea {
    padding: 8px;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-size: 14px;
    font-family: inherit;
  }

  #edit-single-panel input:focus,
  #edit-single-panel select:focus,
  #edit-single-panel textarea:focus {
    outline: none;
    border-color: #83a737;
    box-shadow: 0 0 0 2px rgba(131, 167, 55, 0.2);
  }

  .edit-buttons {
    display: flex;
    gap: 10px;
    justify-content: center;
    margin-top: 20px;
  }

  .edit-buttons button {
    padding: 10px 20px;
    border: none;
    border-radius: 6px;
    font-size: 14px;
    font-weight: bold;
    cursor: pointer;
    transition: background-color 0.2s ease;
  }

  #edit-save-task {
    background-color: #83a737;
    color: white;
  }

  #edit-save-task:hover {
    background-color: #6b8a2a;
  }

  #edit-delete-task {
    background-color: #dc3545;
    color: white;
  }

  #edit-delete-task:hover {
    background-color: #c82333;
  }

  #edit-cancel {
    background-color: #6c757d;
    color: white;
  }

  #edit-cancel:hover {
    background-color: #5a6268;
  }

  /* Адаптивность для мобильных устройств */
  @media (max-width: 600px) {
    #edit-task-modal-content {
      max-width: 95%;
      max-height: 95%;
      padding: 15px;
    }

    .edit-buttons {
      flex-direction: column;
    }

    .edit-buttons button {
      width: 100%;
    }
  }

  /* Анимации для уведомлений */
  @keyframes slideIn {
    from {
      opacity: 0;
      transform: translateX(100%);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }

  @keyframes slideOut {
    from {
      opacity: 1;
      transform: translateX(0);
    }
    to {
      opacity: 0;
      transform: translateX(100%);
    }
  }

  /* Стили для полноэкранного отображения задач */
  .task-fullscreen-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 2px solid #83a737;
  }

  .task-fullscreen-header h2 {
    margin: 0;
    color: #333;
    font-size: 1.8em;
  }

  .close-fullscreen-btn {
    background: #fc9247;
    color: white;
    border: none;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    font-size: 18px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background-color 0.2s ease;
  }

  .close-fullscreen-btn:hover {
    background: #e67e22;
  }

  .task-fullscreen-body {
    font-size: 16px;
    line-height: 1.6;
  }

  .task-line {
    margin-bottom: 12px;
    padding: 8px;
    background-color: #f8f9fa;
    border-radius: 6px;
    border-right: 4px solid #83a737;
  }

  .phone-line {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .call-phone-btn {
    color: #28a745;
    text-decoration: none;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 14px;
    transition: color 0.2s ease;
  }

  .call-phone-btn:hover {
    color: #218838;
  }

  /* Адаптивность для мобильных устройств */
  @media (max-width: 600px) {
    #task-fullscreen-content {
      max-width: 95%;
      max-height: 95%;
      padding: 20px;
    }

    .task-fullscreen-header h2 {
      font-size: 1.5em;
    }

    .task-line {
      font-size: 14px;
    }
  }

  /* Добавьте стиль для .task-label-text, чтобы текст был слева, чекбокс справа */
  .task-label-text {
    flex: 1;
    text-align: right;
    direction: rtl;
    word-break: break-word;
    white-space: pre-line;
  }

  .checkboxes label:not(:last-child) {
    border-left: 1px solid #e0e0e0;
    margin-left: 4px;
    padding-left: 8px;
  }

  .checkboxes {
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
    height: 100%;
  }
  .task-label-text {
    flex: 1;
    text-align: right;
    direction: rtl;
    word-break: break-word;
    white-space: pre-line;
  }

  .task-fullscreen-actions {
    display: flex;
    gap: 10px;
    align-items: center;
  }

  .delete-task-btn {
    background: #dc3545;
    color: white;
    border: none;
    border-radius: 4px;
    padding: 8px 16px;
    font-size: 14px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 5px;
    transition: background-color 0.2s ease;
  }

  .delete-task-btn:hover {
    background: #c82333;
  }

  @media (max-width: 600px) {
    .task-fullscreen-actions {
      flex-direction: row;
      gap: 8px;
    }
    
    .delete-task-btn {
      padding: 6px 12px;
      font-size: 13px;
    }
  }



  .notification {
    position: fixed;
    top: 20px;
    right: 20px;
    background-color: #83a737;
    color: white;
    padding: 12px 20px;
    border-radius: 6px;
    font-size: 14px;
    font-weight: bold;
    z-index: 10000;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    animation: slideIn 0.3s ease;
  }

  .bottom-names-row td {
    text-align: center;
    font-weight: bold;
    padding: 10px;
    border-top: 2px solid #ccc;
    background-color: #83a737;
    color: white;
  }
</style>
